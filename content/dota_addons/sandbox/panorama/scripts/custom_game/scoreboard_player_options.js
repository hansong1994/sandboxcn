var itemAliases = {
    "item_broadsword": {
        "name": "Broadsword",
        "aliases": [],
        "id": "broadsword"
    },
    "item_veil_of_discord": {
        "name": "Veil of Discord",
        "aliases": [],
        "id": "veil_of_discord"
    },
    "item_maelstrom": {
        "name": "Maelstrom",
        "aliases": [],
        "id": "maelstrom"
    },
    "item_satanic": {
        "name": "Satanic",
        "aliases": [],
        "id": "satanic"
    },
    "item_heavens_halberd": {
        "name": "Heaven's Halberd",
        "aliases": [],
        "id": "heavens_halberd"
    },
    "item_rapier": {
        "name": "Divine Rapier",
        "aliases": ["rapier"],
        "id": "rapier"
    },
    "item_eagle": {
        "name": "Eaglesong",
        "aliases": [],
        "id": "eagle"
    },
    "item_ancient_janggo": {
        "name": "Drum of Endurance",
        "aliases": ["drums", "janggo"],
        "id": "ancient_janggo"
    },
    "item_staff_of_wizardry": {
        "name": "Staff of Wizardry",
        "aliases": [],
        "id": "staff_of_wizardry"
    },
    "item_magic_wand": {
        "name": "Magic Wand",
        "aliases": ["wand"],
        "id": "magic_wand"
    },
    "item_vitality_booster": {
        "name": "Vitality Booster",
        "aliases": [],
        "id": "vitality_booster"
    },
    "item_orb_of_venom": {
        "name": "Orb of Venom",
        "aliases": ["oov"],
        "id": "orb_of_venom"
    },
    "item_ring_of_basilius": {
        "name": "Ring of Basilius",
        "aliases": ["basi"],
        "id": "ring_of_basilius"
    },
    "item_vanguard": {
        "name": "Vanguard",
        "aliases": [],
        "id": "vanguard"
    },
    "item_ward_sentry": {
        "name": "Sentry Ward",
        "aliases": ["ward"],
        "id": "ward_sentry"
    },
    "item_energy_booster": {
        "name": "Energy Booster",
        "aliases": [],
        "id": "energy_booster"
    },
    "item_abyssal_blade": {
        "name": "Abyssal Blade",
        "aliases": [],
        "id": "abyssal_blade"
    },
    "item_yasha": {
        "name": "Yasha",
        "aliases": [],
        "id": "yasha"
    },
    "item_relic": {
        "name": "Sacred Relic",
        "aliases": ["relic"],
        "id": "relic"
    },
    "item_radiance": {
        "name": "Radiance",
        "aliases": [],
        "id": "radiance"
    },
    "item_mantle": {
        "name": "Mantle of Intelligence",
        "aliases": [],
        "id": "mantle"
    },
    "item_necronomicon": {
        "name": "Necronomicon",
        "aliases": [],
        "id": "necronomicon"
    },
    "item_void_stone": {
        "name": "Void Stone",
        "aliases": [],
        "id": "void_stone"
    },
    "item_quarterstaff": {
        "name": "Quarterstaff",
        "aliases": [],
        "id": "quarterstaff"
    },
    "item_bloodstone": {
        "name": "Bloodstone",
        "aliases": [],
        "id": "bloodstone"
    },
    "item_ethereal_blade": {
        "name": "Ethereal Blade",
        "aliases": ["eblade"],
        "id": "ethereal_blade"
    },
    "item_skadi": {
        "name": "Eye of Skadi",
        "aliases": ["skadi"],
        "id": "skadi"
    },
    "item_slippers": {
        "name": "Slippers of Agility",
        "aliases": [],
        "id": "slippers"
    },
    "item_soul_booster": {
        "name": "Soul Booster",
        "aliases": [],
        "id": "soul_booster"
    },
    "item_claymore": {
        "name": "Claymore",
        "aliases": [],
        "id": "claymore"
    },
    "item_lesser_crit": {
        "name": "Crystalys",
        "aliases": [],
        "id": "lesser_crit"
    },
    "item_blade_of_alacrity": {
        "name": "Blade of Alacrity",
        "aliases": [],
        "id": "blade_of_alacrity"
    },
    "item_octarine_core": {
        "name": "Octarine Core",
        "aliases": [],
        "id": "octarine_core"
    },
    "item_phase_boots": {
        "name": "Phase Boots",
        "aliases": [],
        "id": "phase_boots"
    },
    "item_reaver": {
        "name": "Reaver",
        "aliases": [],
        "id": "reaver"
    },
    "item_null_talisman": {
        "name": "Null Talisman",
        "aliases": [],
        "id": "null_talisman"
    },
    "item_helm_of_iron_will": {
        "name": "Helm of Iron Will",
        "aliases": [],
        "id": "helm_of_iron_will"
    },
    "item_gem": {
        "name": "Gem of True Sight",
        "aliases": [],
        "id": "gem"
    },
    "item_tranquil_boots": {
        "name": "Tranquil Boots",
        "aliases": [],
        "id": "tranquil_boots"
    },
    "item_ring_of_health": {
        "name": "Ring of Health",
        "aliases": ["roh"],
        "id": "ring_of_health"
    },
    "item_talisman_of_evasion": {
        "name": "Talisman of Evasion",
        "aliases": [],
        "id": "talisman_of_evasion"
    },
    "item_guardian_greaves": {
        "name": "Guardian Greaves",
        "aliases": ["gg", "greaves"],
        "id": "guardian_greaves"
    },
    "item_urn_of_shadows": {
        "name": "Urn of Shadows",
        "aliases": [],
        "id": "urn_of_shadows"
    },
    "item_point_booster": {
        "name": "Point Booster",
        "aliases": [],
        "id": "point_booster"
    },
    "item_ward_observer": {
        "name": "Observer Ward",
        "aliases": ["ward"],
        "id": "ward_observer"
    },
    "item_faerie_fire": {
        "name": "Faerie Fire",
        "aliases": ["ff"],
        "id": "faerie_fire"
    },
    "item_diffusal_blade": {
        "name": "Diffusal Blade",
        "aliases": [],
        "id": "diffusal_blade"
    },
    "item_diffusal_blade_2": {
        "name": "Diffusal Blade 2",
        "aliases": ["diffusal 2", "diffusal2", "diff2"],
        "id": "diffusal_blade_2"
    },
    "item_hood_of_defiance": {
        "name": "Hood of Defiance",
        "aliases": ["hod"],
        "id": "hood_of_defiance"
    },
    "item_gloves": {
        "name": "Gloves of Haste",
        "aliases": [],
        "id": "gloves"
    },
    "item_hand_of_midas": {
        "name": "Hand of Midas",
        "aliases": ["midas"],
        "id": "hand_of_midas"
    },
    "item_pipe": {
        "name": "Pipe of Insight",
        "aliases": [],
        "id": "pipe"
    },
    "item_blink": {
        "name": "Blink Dagger",
        "aliases": ["dagger"],
        "id": "blink"
    },
    "item_silver_edge": {
        "name": "Silver Edge",
        "aliases": [],
        "id": "silver_edge"
    },
    "item_moon_shard": {
        "name": "Moon Shard",
        "aliases": ["shard"],
        "id": "moon_shard"
    },
    "item_soul_ring": {
        "name": "Soul Ring",
        "aliases": ["sr"],
        "id": "soul_ring"
    },
    "item_monkey_king_bar": {
        "name": "Monkey King Bar",
        "aliases": ["mkb"],
        "id": "monkey_king_bar"
    },
    "item_sobi_mask": {
        "name": "Sage's Mask",
        "aliases": [],
        "id": "sobi_mask"
    },
    "item_sphere": {
        "name": "Linken's Sphere",
        "aliases": ["linkens"],
        "id": "sphere"
    },
    "item_lifesteal": {
        "name": "Morbid Mask",
        "aliases": ["lifesteal"],
        "id": "lifesteal"
    },
    "item_iron_talon": {
        "name": "Iron Talon",
        "aliases": ["talon"],
        "id": "iron_talon"
    },
    "item_ring_of_regen": {
        "name": "Ring of Regen",
        "aliases": ["ror"],
        "id": "ring_of_regen"
    },
    "item_blade_mail": {
        "name": "Blade Mail",
        "aliases": ["bm", "blademail"],
        "id": "blade_mail"
    },
    "item_orchid": {
        "name": "Orchid Malevolence",
        "aliases": [],
        "id": "orchid"
    },
    "item_cyclone": {
        "name": "Eul's Scepter of Divinity",
        "aliases": ["euls", "cyclone"],
        "id": "cyclone"
    },
    "item_arcane_boots": {
        "name": "Arcane Boots",
        "aliases": [],
        "id": "arcane_boots"
    },
    "item_robe": {
        "name": "Robe of the Magi",
        "aliases": [],
        "id": "robe"
    },
    "item_pers": {
        "name": "Perseverance",
        "aliases": [],
        "id": "pers"
    },
    "item_desolator": {
        "name": "Desolator",
        "aliases": [],
        "id": "desolator"
    },
    "item_manta": {
        "name": "Manta Style",
        "aliases": [],
        "id": "manta"
    },
    "item_circlet": {
        "name": "Circlet",
        "aliases": [],
        "id": "circlet"
    },
    "item_belt_of_strength": {
        "name": "Belt of Strength",
        "aliases": [],
        "id": "belt_of_strength"
    },
    "item_blades_of_attack": {
        "name": "Blades of Attack",
        "aliases": [],
        "id": "blades_of_attack"
    },
    "item_assault": {
        "name": "Assault Cuirass",
        "aliases": ["ac"],
        "id": "assault"
    },
    "item_flying_courier": {
        "name": "Flying Courier",
        "aliases": ["crow"],
        "id": "flying_courier"
    },
    "item_travel_boots": {
        "name": "Boots of Travel",
        "aliases": ["bot", "bots"],
        "id": "travel_boots"
    },
    "item_travel_boots_2": {
        "name": "Boots of Travel 2",
        "aliases": ["bot2", "bot 2", "bots2", "bots 2"],
        "id": "travel_boots_2"
    },
    "item_sange": {
        "name": "Sange",
        "aliases": [],
        "id": "sange"
    },
    "item_mjollnir": {
        "name": "Mjollnir",
        "aliases": [],
        "id": "mjollnir"
    },
    "item_solar_crest": {
        "name": "Solar Crest",
        "aliases": [],
        "id": "solar_crest"
    },
    "item_echo_sabre": {
        "name": "Echo Sabre",
        "aliases": [],
        "id": "echo_sabre"
    },
    "item_wraith_band": {
        "name": "Wraith Band",
        "aliases": [],
        "id": "wraith_band"
    },
    "item_armlet": {
        "name": "Armlet of Mordiggian",
        "aliases": [],
        "id": "armlet"
    },
    "item_crimson_guard": {
        "name": "Crimson Guard",
        "aliases": [],
        "id": "crimson_guard"
    },
    "item_ghost": {
        "name": "Ghost Scepter",
        "aliases": ["scepter"],
        "id": "ghost"
    },
    "item_glimmer_cape": {
        "name": "Glimmer Cape",
        "aliases": [],
        "id": "glimmer_cape"
    },
    "item_mekansm": {
        "name": "Mekansm",
        "aliases": [],
        "id": "mekansm"
    },
    "item_poor_mans_shield": {
        "name": "Poor Man's Shield",
        "aliases": ["pms"],
        "id": "poor_mans_shield"
    },
    "item_helm_of_the_dominator": {
        "name": "Helm of the Dominator",
        "aliases": ["hotd"],
        "id": "helm_of_the_dominator"
    },
    "item_basher": {
        "name": "Skull Basher",
        "aliases": ["basher"],
        "id": "basher"
    },
    "item_infused_raindrop": {
        "name": "Infused Raindrop",
        "aliases": ["raindrop", "raindrops"],
        "id": "infused_raindrop"
    },
    "item_boots": {
        "name": "Boots of Speed",
        "aliases": ["brown boot", "brown boots"],
        "id": "boots"
    },
    "item_shivas_guard": {
        "name": "Shiva's Guard",
        "aliases": ["shivas"],
        "id": "shivas_guard"
    },
    "item_stout_shield": {
        "name": "Stout Shield",
        "aliases": [],
        "id": "stout_shield"
    },
    "item_rod_of_atos": {
        "name": "Rod of Atos",
        "aliases": ["roa"],
        "id": "rod_of_atos"
    },
    "item_heart": {
        "name": "Heart of Tarrasque",
        "aliases": [],
        "id": "heart"
    },
    "item_clarity": {
        "name": "Clarity",
        "aliases": [],
        "id": "clarity"
    },
    "item_enchanted_mango": {
        "name": "Enchanted Mango",
        "aliases": ["mango"],
        "id": "enchanted_mango"
    },
    "item_lotus_orb": {
        "name": "Lotus Orb",
        "aliases": [],
        "id": "lotus_orb"
    },
    "item_hyperstone": {
        "name": "Hyperstone",
        "aliases": [],
        "id": "hyperstone"
    },
    "item_bloodthorn": {
        "name": "Bloodthorn",
        "aliases": [],
        "id": "bloodthorn"
    },
    "item_cloak": {
        "name": "Cloak",
        "aliases": [],
        "id": "cloak"
    },
    "item_boots_of_elves": {
        "name": "Band of Elvenskin",
        "aliases": [],
        "id": "boots_of_elves"
    },
    "item_medallion_of_courage": {
        "name": "Medallion of Courage",
        "aliases": ["moc"],
        "id": "medallion_of_courage"
    },
    "item_refresher": {
        "name": "Refresher Orb",
        "aliases": [],
        "id": "refresher"
    },
    "item_dagon": {
        "name": "Dagon",
        "aliases": ["dagon1", "dagon 1"],
        "id": "dagon"
    },
    "item_dagon_2": {
        "name": "Dagon 2",
        "aliases": ["dagon2", "dagon 2"],
        "id": "dagon_2"
    },
    "item_dagon_3": {
        "name": "Dagon 3",
        "aliases": ["dagon3", "dagon 3"],
        "id": "dagon_3"
    },
    "item_dagon_4": {
        "name": "Dagon 4",
        "aliases": ["dagon4", "dagon 4"],
        "id": "dagon_4"
    },
    "item_dagon_5": {
        "name": "Dagon 5",
        "aliases": ["dagon5", "dagon 5"],
        "id": "dagon_5"
    },
    "item_quelling_blade": {
        "name": "Quelling Blade",
        "aliases": ["qb"],
        "id": "quelling_blade"
    },
    "item_mask_of_madness": {
        "name": "Mask of Madness",
        "aliases": ["mom"],
        "id": "mask_of_madness"
    },
    "item_invis_sword": {
        "name": "Shadow Blade",
        "aliases": ["sb"],
        "id": "invis_sword"
    },
    "item_force_staff": {
        "name": "Force Staff",
        "aliases": ["fs"],
        "id": "force_staff"
    },
    "item_blight_stone": {
        "name": "Blight Stone",
        "aliases": [],
        "id": "blight_stone"
    },
    "item_smoke_of_deceit": {
        "name": "Smoke of Deceit",
        "aliases": [],
        "id": "smoke_of_deceit"
    },
    "item_mystic_staff": {
        "name": "Mystic Staff",
        "aliases": [],
        "id": "mystic_staff"
    },
    "item_butterfly": {
        "name": "Butterfly",
        "aliases": ["bfly"],
        "id": "butterfly"
    },
    "item_chainmail": {
        "name": "Chainmail",
        "aliases": [],
        "id": "chainmail"
    },
    "item_mithril_hammer": {
        "name": "Mithril Hammer",
        "aliases": [],
        "id": "mithril_hammer"
    },
    "item_magic_stick": {
        "name": "Magic Stick",
        "aliases": ["stick"],
        "id": "magic_stick"
    },
    "item_courier": {
        "name": "Animal Courier",
        "aliases": ["courier"],
        "id": "courier"
    },
    "item_tome_of_knowledge": {
        "name": "Tome of Knowledge",
        "aliases": [],
        "id": "tome_of_knowledge"
    },
    "item_vladmir": {
        "name": "Vladmir's Offering",
        "aliases": ["vlads", "vladmirs"],
        "id": "vladmir"
    },
    "item_dust": {
        "name": "Dust of Appearance",
        "aliases": [],
        "id": "dust"
    },
    "item_headdress": {
        "name": "Headdress",
        "aliases": [],
        "id": "headdress"
    },
    "item_platemail": {
        "name": "Platemail",
        "aliases": [],
        "id": "platemail"
    },
    "item_ogre_axe": {
        "name": "Ogre Club",
        "aliases": [],
        "id": "ogre_axe"
    },
    "item_branches": {
        "name": "Iron Branch",
        "aliases": ["gg", "branch"],
        "id": "branches"
    },
    "item_hurricane_pike": {
        "name": "Hurricane Pike",
        "aliases": ["pike"],
        "id": "hurricane_pike"
    },
    "item_black_king_bar": {
        "name": "Black King Bar",
        "aliases": ["bkb"],
        "id": "black_king_bar"
    },
    "item_dragon_lance": {
        "name": "Dragon Lance",
        "aliases": ["lance"],
        "id": "dragon_lance"
    },
    "item_buckler": {
        "name": "Buckler",
        "aliases": [],
        "id": "buckler"
    },
    "item_bottle": {
        "name": "Bottle",
        "aliases": [],
        "id": "bottle"
    },
    "item_greater_crit": {
        "name": "Daedalus",
        "aliases": [],
        "id": "greater_crit"
    },
    "item_demon_edge": {
        "name": "Demon Edge",
        "aliases": [],
        "id": "demon_edge"
    },
    "item_shadow_amulet": {
        "name": "Shadow Amulet",
        "aliases": ["amulet"],
        "id": "shadow_amulet"
    },
    "item_gauntlets": {
        "name": "Gauntlets of Strength",
        "aliases": [],
        "id": "gauntlets"
    },
    "item_sheepstick": {
        "name": "Scythe of Vyse",
        "aliases": ["sheep", "sheepstick"],
        "id": "sheepstick"
    },
    "item_wind_lace": {
        "name": "Wind Lace",
        "aliases": [],
        "id": "wind_lace"
    },
    "item_bracer": {
        "name": "Bracer",
        "aliases": [],
        "id": "bracer"
    },
    "item_sange_and_yasha": {
        "name": "Sange and Yasha",
        "aliases": ["sny"],
        "id": "sange_and_yasha"
    },
    "item_ultimate_orb": {
        "name": "Ultimate Orb",
        "aliases": [],
        "id": "ultimate_orb"
    },
    "item_power_treads": {
        "name": "Power Treads",
        "aliases": ["pt", "treads"],
        "id": "power_treads"
    },
    "item_javelin": {
        "name": "Javelin",
        "aliases": [],
        "id": "javelin"
    },
    "item_tango": {
        "name": "Tango",
        "aliases": [],
        "id": "tango"
    },
    "item_tpscroll": {
        "name": "Town Portal Scroll",
        "aliases": ["tp"],
        "id": "tpscroll"
    },
    "item_ring_of_aquila": {
        "name": "Ring of Aquila",
        "aliases": ["aquila", "roa"],
        "id": "ring_of_aquila"
    },
    "item_oblivion_staff": {
        "name": "Oblivion Staff",
        "aliases": [],
        "id": "oblivion_staff"
    },
    "item_flask": {
        "name": "Healing Salve",
        "aliases": ["salve"],
        "id": "flask"
    },
    "item_ultimate_scepter": {
        "name": "Aghanim's Scepter",
        "aliases": ["aghs"],
        "id": "ultimate_scepter"
    },
    "item_bfury": {
        "name": "Battle Fury",
        "aliases": ["bfury"],
        "id": "bfury"
    },
    "item_aether_lens": {
        "name": "Aether Lens",
        "aliases": [],
        "id": "aether_lens"
    },
    "item_ring_of_protection": {
        "name": "Ring of Protection",
        "aliases": ["rop"],
        "id": "ring_of_protection"
    }
}

var items = [];
for (var k in itemAliases) {
    if (itemAliases.hasOwnProperty(k)) {
        items.push(k);
    }
}

var searchTerm = $("#ItemSearchTextbox").text || "";
var poll = false;

function startsWith(s, t) {
    return s.indexOf(t) == 0;
}

function findMatches(s) {
    var s = s.toLowerCase();
    var matches = {
        good: [],
        bad: []
    };
    for (var i = 0; i < items.length; i++) {
        var k = items[i];
        if (startsWith(itemAliases[k].name.toLowerCase(), s) || startsWith(itemAliases[k].id, s) || itemAliases[k].aliases.indexOf(s) != -1) {
            matches.good.push(k);
        }
        else {
            matches.bad.push(k);
        }
    }
    return matches;
}

function OnItemSearchFocus() {
    if (!poll) {
        poll = true;
        PollSearch();
    }
}

function ProcessSearch() {
    var matches = findMatches($("#ItemSearchTextbox").text);
    for (var i = 0; i < matches.good.length; i++) {
        $("#" + matches.good[i]).visible = true;
    }
    for (var i = 0; i < matches.bad.length; i++) {
        $("#" + matches.bad[i]).visible = false;
    }
    return matches;
}

function PollSearch() {
    if (poll) {
        if (searchTerm != $("#ItemSearchTextbox").text) {
            searchTerm = $("#ItemSearchTextbox").text;
            ProcessSearch();
        }
        $.Schedule(.25, PollSearch);
    }
}

function PortraitClicked() {
    // TODO: ctrl and alt click support
    Players.PlayerPortraitClicked($.GetContextPanel().GetAttributeInt("player_id", -1), false, false);
    //$.Msg("click", $.GetContextPanel().GetAttributeInt( "player_id", -1 ));
}

function Destroy() {
    if (GameUI.CustomUIConfig().CustomDropDown.OpenFor != $.GetContextPanel()) {
        $.GetContextPanel().RemoveClass("active");
        $.GetContextPanel().ClearActive();
        CloseCustomDropDown();
    }
}

function OnHeroChanged() {
    GameEvents.SendCustomGameEventToServer("ChangeHeroButtonPressed", {
        pID: $.GetContextPanel().GetAttributeInt("player_id", -1),
        PlayerID: $.GetContextPanel().GetAttributeInt("player_id", -1),
        selectedHero: $('#HeroDropDown').GetSelected().id
    });
}

function ItemClick(item) {
    GameEvents.SendCustomGameEventToServer("ShopItemButtonPressed", {
        pID: $.GetContextPanel().GetAttributeInt("player_id", -1),
        item: item
    });
}

function SelectHero(data) {
    GameUI.SelectUnit(data.entId, false);
}

function OpenCustomDropDown() {
    GameUI.CustomUIConfig().CustomDropDown.OpenFor = $.GetContextPanel();
    var CustomDropDown = GameUI.CustomUIConfig().CustomDropDown;
    var pos = CustomDropDown.GetAbsoluteOffset($.GetContextPanel(), $("#HeroCustomDropDown"));
    CustomDropDown.SetPos(pos);
    CustomDropDown.OnHeroSelected = OnHeroSelected;
    CustomDropDown.OnClose = OnClose;
    CustomDropDown.Open();
}

function CloseCustomDropDown() {
    GameUI.CustomUIConfig().CustomDropDown.Close();
}

function OnHeroSelected(heroId, heroName) {
    $("#HeroCustomDropDownLabel").text = heroName;
    GameEvents.SendCustomGameEventToServer("ChangeHeroButtonPressed", {
        pID: $.GetContextPanel().GetAttributeInt("player_id", -1),
        PlayerID: $.GetContextPanel().GetAttributeInt("player_id", -1),
        selectedHero: heroId
    });
    $("#HeroCustomDropDown").SetFocus();
}

function OnClose() {
    if ($.GetContextPanel().BHasClass("active")) {
        $("#HeroCustomDropDown").SetFocus();
    }
}

(function() {
    var selectedHero = GameUI.CustomUIConfig().CustomDropDown.heroAliases[Players.GetPlayerSelectedHero($.GetContextPanel().GetAttributeInt("player_id", -1))];
    if (selectedHero) {
        $('#HeroCustomDropDownLabel').text = selectedHero.name;
    }
    GameEvents.Subscribe("select_hero", SelectHero);
})();